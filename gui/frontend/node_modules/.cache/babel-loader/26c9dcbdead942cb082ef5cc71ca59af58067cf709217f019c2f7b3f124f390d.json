{"ast":null,"code":"import{useState,useEffect,useCallback}from'react';import{chatApi,projectApi}from'./client';// 聊天Hook\nexport const useChat=()=>{const[messages,setMessages]=useState([]);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(null);// 发送消息\nconst sendMessage=useCallback(async function(message){let model=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'gpt-3.5-turbo';if(!message.trim()){setError('消息不能为空');return;}setIsLoading(true);setError(null);try{const request={message:message.trim(),model};const response=await chatApi.sendMessage(request);if(response.success&&response.history){setMessages(response.history);}else{setError(response.error||'发送消息失败');}}catch(err){var _err$response,_err$response$data;console.error('Send message error:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||err.message||'网络错误');}finally{setIsLoading(false);}},[]);// 清空历史\nconst clearHistory=useCallback(async()=>{setIsLoading(true);setError(null);try{const response=await chatApi.clearHistory();if(response.success){setMessages([]);}else{setError(response.error||'清空历史失败');}}catch(err){var _err$response2,_err$response2$data;console.error('Clear history error:',err);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||err.message||'网络错误');}finally{setIsLoading(false);}},[]);// 加载历史\nconst loadHistory=useCallback(async function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:50;setIsLoading(true);setError(null);try{const response=await chatApi.getHistory(limit);if(response.success&&response.history){setMessages(response.history);}else{setError(response.error||'加载历史失败');}}catch(err){var _err$response3,_err$response3$data;console.error('Load history error:',err);setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.error)||err.message||'网络错误');}finally{setIsLoading(false);}},[]);// 组件挂载时加载历史\nuseEffect(()=>{loadHistory();},[loadHistory]);return{messages,isLoading,error,sendMessage,clearHistory,loadHistory};};// 项目管理Hook\nexport const useProjects=()=>{const[projects,setProjects]=useState([]);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(null);const loadProjects=useCallback(async()=>{setIsLoading(true);setError(null);try{const response=await projectApi.getProjects();if(response.success){setProjects(response.message||[]);}else{setError(response.error||'加载项目失败');}}catch(err){var _err$response4,_err$response4$data;console.error('Load projects error:',err);setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.error)||err.message||'网络错误');}finally{setIsLoading(false);}},[]);const scanProjects=useCallback(async()=>{setIsLoading(true);setError(null);try{const response=await projectApi.scanProjects();if(response.success){await loadProjects();// 重新加载项目列表\n}else{setError(response.error||'扫描项目失败');}}catch(err){var _err$response5,_err$response5$data;console.error('Scan projects error:',err);setError(((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.error)||err.message||'网络错误');}finally{setIsLoading(false);}},[loadProjects]);useEffect(()=>{loadProjects();},[loadProjects]);return{projects,isLoading,error,loadProjects,scanProjects};};","map":{"version":3,"names":["useState","useEffect","useCallback","chatApi","projectApi","useChat","messages","setMessages","isLoading","setIsLoading","error","setError","sendMessage","message","model","arguments","length","undefined","trim","request","response","success","history","err","_err$response","_err$response$data","console","data","clearHistory","_err$response2","_err$response2$data","loadHistory","limit","getHistory","_err$response3","_err$response3$data","useProjects","projects","setProjects","loadProjects","getProjects","_err$response4","_err$response4$data","scanProjects","_err$response5","_err$response5$data"],"sources":["/Users/maiyou001/.ai-assistant/gui/frontend/src/api/hooks.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { chatApi, projectApi, ChatMessage, SendMessageRequest, ApiResponse } from './client';\n\nexport interface UseChatReturn {\n  messages: ChatMessage[];\n  isLoading: boolean;\n  error: string | null;\n  sendMessage: (message: string, model?: string) => Promise<void>;\n  clearHistory: () => Promise<void>;\n  loadHistory: (limit?: number) => Promise<void>;\n}\n\n// 聊天Hook\nexport const useChat = (): UseChatReturn => {\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // 发送消息\n  const sendMessage = useCallback(async (message: string, model = 'gpt-3.5-turbo') => {\n    if (!message.trim()) {\n      setError('消息不能为空');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const request: SendMessageRequest = { message: message.trim(), model };\n      const response: ApiResponse<ChatMessage> = await chatApi.sendMessage(request);\n\n      if (response.success && response.history) {\n        setMessages(response.history);\n      } else {\n        setError(response.error || '发送消息失败');\n      }\n    } catch (err: any) {\n      console.error('Send message error:', err);\n      setError(err.response?.data?.error || err.message || '网络错误');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // 清空历史\n  const clearHistory = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response: ApiResponse = await chatApi.clearHistory();\n      if (response.success) {\n        setMessages([]);\n      } else {\n        setError(response.error || '清空历史失败');\n      }\n    } catch (err: any) {\n      console.error('Clear history error:', err);\n      setError(err.response?.data?.error || err.message || '网络错误');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // 加载历史\n  const loadHistory = useCallback(async (limit = 50) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response: ApiResponse<ChatMessage[]> = await chatApi.getHistory(limit);\n      if (response.success && response.history) {\n        setMessages(response.history);\n      } else {\n        setError(response.error || '加载历史失败');\n      }\n    } catch (err: any) {\n      console.error('Load history error:', err);\n      setError(err.response?.data?.error || err.message || '网络错误');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // 组件挂载时加载历史\n  useEffect(() => {\n    loadHistory();\n  }, [loadHistory]);\n\n  return {\n    messages,\n    isLoading,\n    error,\n    sendMessage,\n    clearHistory,\n    loadHistory,\n  };\n};\n\n// 项目管理Hook\nexport const useProjects = () => {\n  const [projects, setProjects] = useState<any[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadProjects = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response = await projectApi.getProjects();\n      if (response.success) {\n        setProjects(response.message || []);\n      } else {\n        setError(response.error || '加载项目失败');\n      }\n    } catch (err: any) {\n      console.error('Load projects error:', err);\n      setError(err.response?.data?.error || err.message || '网络错误');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const scanProjects = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response = await projectApi.scanProjects();\n      if (response.success) {\n        await loadProjects(); // 重新加载项目列表\n      } else {\n        setError(response.error || '扫描项目失败');\n      }\n    } catch (err: any) {\n      console.error('Scan projects error:', err);\n      setError(err.response?.data?.error || err.message || '网络错误');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [loadProjects]);\n\n  useEffect(() => {\n    loadProjects();\n  }, [loadProjects]);\n\n  return {\n    projects,\n    isLoading,\n    error,\n    loadProjects,\n    scanProjects,\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}