# 系统状态监控功能说明

## 功能概述

在设置页面新增了 **🔌 系统状态** 卡片，实时显示所有服务的运行状态和系统资源使用情况。

## 更新时间
**2025年12月1日**

---

## 📋 功能特性

### 1. 服务状态监控

实时显示三个核心服务的运行状态：

#### 🔹 后端服务
- **状态**: 运行中/已停止
- **端口**: 5178
- **响应时间**: 实时 API 响应时间（毫秒）
- **运行时长**: 自启动以来的运行时间

#### 🔹 WebSocket 服务
- **状态**: 运行中/已停止
- **端口**: 5179
- **连接数**: 当前活跃的 WebSocket 连接数

#### 🔹 前端服务
- **状态**: 运行中/已停止
- **端口**: 4000

### 2. 系统资源监控

实时显示系统资源使用情况：

#### 💻 系统信息
- **操作系统**: macOS/Linux/Windows
- **架构**: x64/arm64
- **Node.js 版本**: 当前运行版本

#### 🧠 CPU 信息
- **型号**: 处理器型号（如 Apple M2）
- **核心数**: CPU 核心数量

#### 📊 内存使用
- **总内存**: 系统总内存容量
- **已使用**: 当前已使用的内存
- **使用率**: 内存使用百分比

#### ⏱️ 系统运行时间
- 显示系统自启动以来的运行时长
- 格式: X天X小时 / X小时X分钟 / X分钟X秒

---

## 🎨 UI 特性

### 状态指示器
- ✅ **绿色 + 对勾**: 服务运行中
- ❌ **红色 + 叉号**: 服务已停止
- ⚠️ **黄色 + 问号**: 状态未知
- 🔄 **蓝色 + 旋转**: 检测中

### 视觉设计
- **渐变背景**: 青绿色渐变头部
- **悬停效果**: 卡片悬停时轻微上浮并显示阴影
- **响应式布局**: 自适应桌面和移动设备
- **实时刷新**: 每30秒自动刷新一次
- **手动刷新**: 点击右上角 "🔄 刷新" 按钮

---

## 🔧 技术实现

### 后端 API
**接口**: `GET /api/system-status`

**响应格式**:
```json
{
  "success": true,
  "services": {
    "backend": {
      "status": "running",
      "port": 5178,
      "responseTime": "1ms",
      "uptime": "120s"
    },
    "websocket": {
      "status": "running",
      "port": 5179,
      "clients": 2
    },
    "frontend": {
      "status": "unknown",
      "port": 4000
    }
  },
  "system": {
    "platform": "darwin",
    "arch": "arm64",
    "nodeVersion": "v18.20.4",
    "uptime": 12345.67,
    "memory": {
      "total": 8589934592,
      "free": 135299072,
      "used": 8454635520,
      "usagePercent": "98.42"
    },
    "cpu": {
      "model": "Apple M2",
      "cores": 8
    }
  },
  "timestamp": "2025-12-01T12:00:00.000Z"
}
```

### 前端实现
- **框架**: React + TypeScript
- **UI 组件**: Ant Design (Card, Badge, Spin, Icons)
- **状态管理**: React Hooks (useState, useEffect)
- **自动刷新**: setInterval 每30秒
- **错误处理**: try-catch + 用户提示

---

## 📂 修改文件清单

### 后端
- ✅ `server/server.js`
  - 新增 `/api/system-status` 接口
  - 集成系统信息采集（os 模块）
  - WebSocket 客户端统计

### 前端
- ✅ `frontend/src/pages/Settings.tsx`
  - 新增 SystemStatus 接口定义
  - 新增状态获取逻辑
  - 新增状态展示 UI
  - 新增自动刷新机制

- ✅ `frontend/src/pages/Settings.css`
  - 新增系统状态卡片样式
  - 新增状态指示器样式
  - 新增响应式布局
  - 新增悬停动画效果

---

## 🚀 使用方法

### 1. 访问系统状态
```bash
# 启动服务
ai

# 或手动启动
bash ~/.ai-assistant/gui/scripts/AI助理.command
```

### 2. 查看状态
1. 打开浏览器访问 http://localhost:4000
2. 点击左侧菜单的 **⚙️ 设置**
3. 滚动查看 **🔌 系统状态** 卡片

### 3. 刷新状态
- **自动刷新**: 每30秒自动更新
- **手动刷新**: 点击卡片右上角的 "🔄 刷新" 按钮

---

## 🔍 故障排查

### 问题 1: 无法获取系统状态

**症状**: 显示 "无法获取系统状态"

**解决方法**:
```bash
# 检查后端服务
lsof -i :5178

# 如果没有输出，重启后端
pkill -f "node server\.js"
cd ~/.ai-assistant/gui/server
nohup node server.js > /tmp/ai-assistant-server.log 2>&1 &

# 查看后端日志
tail -f /tmp/ai-assistant-server.log
```

### 问题 2: 数据显示不准确

**症状**: 服务状态或系统信息显示异常

**解决方法**:
```bash
# 直接测试 API
curl http://localhost:5178/api/system-status | python3 -m json.tool

# 检查返回数据是否正常
```

### 问题 3: WebSocket 客户端数量为 0

**原因**: WebSocket 仅在 APK 加固过程中建立连接

**正常现象**: 未进行加固操作时，客户端数量为 0

---

## 📊 数据说明

### 内存使用率高是否正常？

- macOS 系统会主动使用大量内存作为缓存
- 高内存使用率（>90%）在 macOS 上是正常的
- 只要系统不卡顿，无需担心

### 响应时间多少算正常？

- **优秀**: < 5ms
- **良好**: 5-20ms
- **一般**: 20-50ms
- **较慢**: > 50ms

### WebSocket 连接数意义？

- **0**: 无活跃加固任务
- **1**: 有1个浏览器标签页在进行加固
- **N**: N个标签页或N个并发加固任务

---

## 🎯 未来优化方向

### 短期优化
- [ ] 添加历史数据图表
- [ ] 添加性能趋势分析
- [ ] 支持导出系统报告

### 中期优化
- [ ] 集成日志查看功能
- [ ] 添加服务重启按钮
- [ ] 添加告警通知机制

### 长期优化
- [ ] 多节点集群监控
- [ ] 分布式追踪
- [ ] APM 性能监控集成

---

## 📝 版本历史

### v1.0.0 - 2025年12月1日
- ✨ 首次发布系统状态监控功能
- ✨ 支持三大服务状态监控
- ✨ 支持系统资源监控
- ✨ 支持自动/手动刷新
- ✨ 响应式 UI 设计

---

## 🙏 致谢

感谢以下开源项目的支持：
- React - 前端框架
- Ant Design - UI 组件库
- Node.js - 后端运行时
- Express - Web 框架
